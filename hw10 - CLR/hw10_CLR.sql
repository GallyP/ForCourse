exec sp_configure 'show advanced options', 1;
GO
reconfigure;
GO

exec sp_configure 'clr enabled', 1;
exec sp_configure 'clr strict security', 0 
GO

-- clr strict security 
-- 1 (Enabled): заставляет Database Engine игнорировать сведения PERMISSION_SET о сборках 
-- и всегда интерпретировать их как UNSAFE. По умолчанию, начиная с SQL Server 2017.

reconfigure;
GO

ALTER DATABASE WideWorldImporters SET TRUSTWORTHY ON; 

--DROP ASSEMBLY IF EXISTS SplitString
--GO

--USE [WideWorldImporters]
--GO

--CREATE ASSEMBLY [SplitString]
--FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C0103002767B7600000000000000000E00022200B013000000E000000060000000000008A2C0000002000000040000000000010002000000002000004000000000000000600000000000000008000000002000000000000030060850000100000100000000010000010000000000000100000000000000000000000382C00004F00000000400000C802000000000000000000000000000000000000006000000C000000002B00001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000900C000000200000000E000000020000000000000000000000000000200000602E72737263000000C8020000004000000004000000100000000000000000000000000000400000402E72656C6F6300000C00000000600000000200000014000000000000000000000000000040000042000000000000000000000000000000006C2C0000000000004800000002000500B82100004809000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005616730400000625027D0300000425037D040000042A0000133002002D000000010000110002A50200001B0A041200280D00000A280E00000A810B000001031200280F00000A281000000A810A0000012A2202281100000A002A3E02281100000A0002037D010000042A062A13300400E100000002000011027B010000040A062C082B0006172E042B072B073892000000162A02157D0100000400027C03000004281200000A0B072C02162A02177D050000040002027C03000004281300000A027B04000004176F1400000A7D0600000402167D070000042B6602027B06000004027B070000049A7D080000040002027B050000040C020817587D0500000408027B080000046F1500000A731600000A8C0200001B7D0200000402177D01000004172A02157D010000040002147D0800000402027B0700000417587D07000004027B07000004027B060000048E69328A02147D06000004162A1E027B020000042A1A731700000A7A42534A4201000100000000000C00000076342E302E33303331390000000005006C00000038030000237E0000A40300002C04000023537472696E677300000000D00700000400000023555300D4070000100000002347554944000000E40700006401000023426C6F6200000000000000020000015717A20B0902000000FA01330016000001000000130000000300000008000000090000000600000003000000170000000B0000000200000001000000020000000200000005000000020000000100000002000000010000000000AE0101000000000006004A01490206006A0149020600EB0036020F00690200000600C802CF010600A500CF010600FF0049020A003501FB01060024028D020A00980178020A0032007802060042007E000600D000490206009900CF01060024007E0006001D0136020600A701CF010600B502CF010600DB01CF01000000006000000000000100010001001000D902A00215000100010003011000010000001500010004000100C5006E000100EA0371000600000474000600F1017800010013006E0001003B007C00010051006E000100580080005020000000009600A20183000100682000000000960005048C000300A120000000008618300206000600AA20000000008618300201000600BA2000000000E101AA0006000700BC2000000000E101F70316000700A92100000000E1097D0325000700B12100000000E101E10206000700A92100000000E109BF032500070000000100000400000200F10100000100160202000200920102000300180400000100C500030006000300390003002500090030020100110030020600190030020A003900300210004100300206006900300206007100BD0006004900F70316000C00DE0320004900000306004900DE032500810030020600140023042000590006033900140088013F005100060344002900300206005100C40116005100880150008900120354008900D6015000140030025D0099003002060020002300CC0020002B0000012E000B009B002E001300A4002E001B00C300630033005F01800063005F01A00063005F01E00063005F01000163005F01200163005F0129004A000300010000001803970000005603970002000700030002000900050003000A000F0003000C00110003000E0013000300100015000300120017001A003200048000000000000000000000000000000000CF020000040000000000000000000000650075000000000004000000000000000000000065006900000000000300020000000000003C53706C6974537472696E673E645F5F30003C76616C7565496E6465783E355F5F310049456E756D657261746F7260310053716C496E743332003C3E735F5F32004B657956616C7565506169726032003C3E735F5F33003C733E355F5F34003C4D6F64756C653E0053797374656D2E44617461006D73636F726C69620053797374656D2E436F6C6C656374696F6E732E47656E657269630049446973706F7361626C6500547970650053797374656D2E49446973706F7361626C652E446973706F7365003C3E315F5F737461746500436F6D70696C657247656E6572617465644174747269627574650044656275676761626C65417474726962757465004974657261746F7253746174654D616368696E6541747472696275746500446562756767657248696464656E4174747269627574650053716C46756E6374696F6E41747472696275746500436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C697479417474726962757465006765745F56616C75650076616C75650053716C537472696E670053706C6974537472696E67004D79446174616261736550726F6A6563742E646C6C006765745F49734E756C6C0053797374656D005472696D004E6F74537570706F72746564457863657074696F6E0064656C696D69746572004D6963726F736F66742E53716C5365727665722E536572766572006F4B657956616C7565506169720049456E756D657261746F72002E63746F720053797374656D2E446961676E6F73746963730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300446562756767696E674D6F6465730053797374656D2E446174612E53716C54797065730053797374656D2E436F6C6C656374696F6E730055736572446566696E656446756E6374696F6E7300537472696E6753706C69744F7074696F6E73004F626A656374004D79446174616261736550726F6A6563740053797374656D2E436F6C6C656374696F6E732E49456E756D657261746F722E5265736574006F705F496D706C696369740053706C69740053797374656D2E436F6C6C656374696F6E732E47656E657269632E49456E756D657261746F723C53797374656D2E4F626A6563743E2E43757272656E740053797374656D2E436F6C6C656374696F6E732E49456E756D657261746F722E43757272656E740053797374656D2E436F6C6C656374696F6E732E47656E657269632E49456E756D657261746F723C53797374656D2E4F626A6563743E2E6765745F43757272656E740053797374656D2E436F6C6C656374696F6E732E49456E756D657261746F722E6765745F43757272656E74003C3E325F5F63757272656E74004D6F76654E65787400746578740053706C6974537472696E6746696C6C526F770076616C7565496E646578006765745F4B6579000000000000B2C362CD85D0084E8DF6EC28DDD2912400042001010803200001052001011111052001011219032000020515123D011C04200013000320001C08070115113102080E0615113102080E050001112D08042000130105000111290E0507030802080320000E0820021D0E1D031149072002011300130108B77A5C561934E08902060802061C0306112903061D0303061D0E02060E080002122511291D030A0003011C10112910112D0328001C0801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F7773010801000701000000003301002E55736572446566696E656446756E6374696F6E732E50726F6A6563742B3C53706C6974537472696E673E645F5F3000005E01000200540E1146696C6C526F774D6574686F644E616D651253706C6974537472696E6746696C6C526F77540E0F5461626C65446566696E6974696F6E2070617274204E56415243484152284D4158292C2049445F4F5244455220494E540401000000000000002767B76000000000020000001C0100001C2B00001C0D000052534453DBB0A54FF19B7B4A8846C238D16AAB8D01000000433A5C55736572735C203131315C446F63756D656E74735C53514C20434F555253455C446174614261736550726F6A65637456535C4D79446174616261736550726F6A6563745C4D79446174616261736550726F6A6563745C6F626A5C44656275675C4D79446174616261736550726F6A6563742E7064620000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000602C000000000000000000007A2C00000020000000000000000000000000000000000000000000006C2C0000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF25002000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001000000018000080000000000000000000000000000001000100000030000080000000000000000000000000000001000000000048000000584000006C02000000000000000000006C0234000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000000000000000000000000000000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004CC010000010053007400720069006E006700460069006C00650049006E0066006F000000A801000001003000300030003000300034006200300000002C0002000100460069006C0065004400650073006300720069007000740069006F006E000000000020000000300008000100460069006C006500560065007200730069006F006E000000000030002E0030002E0030002E00300000004C001600010049006E007400650072006E0061006C004E0061006D00650000004D00790044006100740061006200610073006500500072006F006A006500630074002E0064006C006C0000002800020001004C006500670061006C0043006F0070007900720069006700680074000000200000005400160001004F0072006900670069006E0061006C00460069006C0065006E0061006D00650000004D00790044006100740061006200610073006500500072006F006A006500630074002E0064006C006C000000340008000100500072006F006400750063007400560065007200730069006F006E00000030002E0030002E0030002E003000000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000030002E0030002E0030002E003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C0000008C3C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
--WITH PERMISSION_SET = SAFE
--GO





CREATE ASSEMBLY SplitString
FROM 'C:\Users\ 111\Documents\SQL COURSE\DataBaseProjectVS\MyDatabaseProject\MyDatabaseProject\bin\Debug\MyDatabaseProject.dll'
WITH PERMISSION_SET = SAFE;  


CREATE FUNCTION [dbo].SplitStringCLR(@text nvarchar(max), @delimiter nchar(1))
RETURNS TABLE (
part nvarchar(max),
ID_ODER int
) 
WITH EXECUTE AS CALLER
AS
EXTERNAL NAME SplitString.[UserDefinedFunctions.Project].SplitString

SELECT * FROM dbo.[SplitStringCLR]('a,b,c',',')